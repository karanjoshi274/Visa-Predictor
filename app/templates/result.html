<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Visa Approval Prediction Result</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --brand:#004aad; --bg:#f7f9fc; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg)}
    .nav{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9ecef}
    .nav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:16px;align-items:center}
    .nav a{color:#334; text-decoration:none; padding:8px 10px;border-radius:10px}
    .nav a.active, .nav a:hover{background:#eef4ff;color:var(--brand)}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e9ecef;border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .pad{padding:18px}
    .section-title{margin-top:25px;color:#004aad;border-bottom:2px solid #004aad;padding-bottom:5px}
    ul{background:#fff;padding:15px 25px;border-radius:8px;list-style:none}
    li::before{content:"â€¢ ";color:#004aad;font-weight:bold;margin-left:-12px;margin-right:4px}
    canvas{max-width:100%;margin-top:20px}
    .muted{color:#6c757d}
  </style>
</head>
<body>
  <nav class="nav">
    <div class="wrap">
      <a class="brand" href="/">Visa Assistant</a>
      <div style="margin-left:auto; display:flex; gap:6px;">
        <a href="/">Predict</a>
        <a href="/wage">Wage Comparator</a>
        <a href="/bulk">Bulk Upload</a>
        <a href="/chat">Chatbot</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <div class="card pad">
      <h2 style="margin:0 0 8px">Visa Approval Prediction Result</h2>

      {% if error %}
        <p><strong style="color:red;">Error:</strong> {{ error }}</p>
      {% else %}
        <p><strong>Estimated Approval Probability:</strong> {{ probability }}%</p>
        <p style="font-weight:700; color:
          {% if 'High chance of approval' in recommendation %}#2e8b57
          {% elif 'Moderate' in recommendation %}#e0a800
          {% else %}#c82333{% endif %};">
          {{ recommendation }}
        </p>

        <p><strong>Validation notes:</strong> {{ notes }}</p>

        <h3 class="section-title">Top Factors Affecting Prediction</h3>
        <canvas id="impactChart"></canvas>
        <script id="feature-impact" type="application/json">{{ feature_impact | tojson }}</script>
        <script>
          const raw = document.getElementById('feature-impact')?.textContent || "{}";
          let features = {}; try { features = JSON.parse(raw); } catch(e) { features = {}; }
          const labels = Object.keys(features).slice(0, 8);
          const data = Object.values(features).slice(0, 8);
          const ctx = document.getElementById('impactChart').getContext('2d');
          new Chart(ctx, {
            type:'bar',
            data:{ labels, datasets:[{ label:'Feature Impact (Higher = More Influence)', data,
              backgroundColor: data.map(v => v >= 0 ? 'rgba(46, 139, 87, 0.7)' : 'rgba(200, 35, 51, 0.7)') }]},
            options:{ indexAxis:'y', plugins:{legend:{display:false}}, scales:{x:{title:{display:true,text:'Influence on Approval'}}}}
          });
        </script>

        <h3 class="section-title">ðŸ“ˆ Application Strength Scorecard</h3>
        {% if scorecard %}
          <p><strong>Total Strength:</strong> {{ scorecard.total_score }} / 100</p>
          <div style="background:#fff;padding:16px;border-radius:8px;border:1px solid #e9ecef">
            <div style="margin:10px 0;">
              <div>Wage Competitiveness â€” {{ scorecard.wage_score|round(1) }}/100</div>
              <div title="{{ scorecard.wage_note }}" style="height:10px;background:#e9ecef;border-radius:6px;">
                <div style="height:10px;width:{{ scorecard.wage_score }}%;background:#2e8b57;border-radius:6px;"></div>
              </div>
              <small class="muted">{{ scorecard.wage_note }}</small>
            </div>
            <div style="margin:10px 0;">
              <div>Compliance Posture â€” {{ scorecard.compliance_score|round(1) }}/100</div>
              <div style="height:10px;background:#e9ecef;border-radius:6px;">
                <div style="height:10px;width:{{ scorecard.compliance_score }}%;background:#2e8b57;border-radius:6px;"></div>
              </div>
            </div>
            <div style="margin:10px 0;">
              <div>Employment Stability â€” {{ scorecard.stability_score|round(1) }}/100</div>
              <div style="height:10px;background:#e9ecef;border-radius:6px;">
                <div style="height:10px;width:{{ scorecard.stability_score }}%;background:#2e8b57;border-radius:6px;"></div>
              </div>
            </div>
            <div style="margin:10px 0;">
              <div>Documentation Completeness â€” {{ scorecard.documentation_score|round(1) }}/100</div>
              <div style="height:10px;background:#e9ecef;border-radius:6px;">
                <div style="height:10px;width:{{ scorecard.documentation_score }}%;background:#2e8b57;border-radius:6px;"></div>
              </div>
            </div>
          </div>
        {% else %}
          <p>Scorecard not available.</p>
        {% endif %}

        <h3 class="section-title">ðŸ’¡ Personalized Suggestions</h3>
        <ul>
          {% for s in suggestions %}<li>{{ s }}</li>{% endfor %}
        </ul>

        <p><strong>Email:</strong> {{ email }}</p>

        <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
          <a class="card pad" href="/wage">ðŸ’¼ Compare this wage again</a>
          <a class="card pad" href="/chat">ðŸ’¬ Ask the assistant about these results</a>
          <a class="card pad" href="/bulk">ðŸ“¤ Run similar cases in bulk</a>
        </div>
      {% endif %}
    </div>
  </main>
</body>
</html>
