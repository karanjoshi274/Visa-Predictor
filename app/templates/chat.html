<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Visa Assistant Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--brand:#004aad;--bg:#f7f9fc}
    body { margin:0; font-family: system-ui, Arial; background:var(--bg); }
    .nav{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9ecef}
    .nav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:16px;align-items:center}
    .nav a{color:#334; text-decoration:none; padding:8px 10px;border-radius:10px}
    .nav a.active, .nav a:hover{background:#eef4ff;color:var(--brand)}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e9ecef;border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .pad{padding:18px}
    .chat { background:#fff; border-radius:16px; box-shadow:0 6px 18px rgba(0,0,0,.08);
            padding:16px; min-height: 60vh; display:flex; flex-direction:column; }
    .msgs { flex:1; overflow:auto; padding:8px 4px; }
    .bubble { max-width:70%; padding:12px 14px; border-radius:14px; margin:8px 0; line-height:1.45; }
    .me { margin-left:auto; background:#e9f0ff; color:#0a1b4d; border-top-right-radius:4px; }
    .bot { margin-right:auto; background:#f3f6fa; color:#222; border-top-left-radius:4px; }
    .actions { margin-top:6px; display:flex; flex-wrap:wrap; gap:8px; }
    .action-btn { background:#004aad; color:#fff; border:none; padding:8px 10px; border-radius:10px;
                  cursor:pointer; font-size:0.9rem; text-decoration:none; display:inline-block; }
    .action-btn.secondary { background:#e5eaf5; color:#193; }
    .inputbar { display:flex; gap:8px; margin-top:12px; }
    .inputbar input { flex:1; padding:12px 14px; border:1px solid #d9deea; border-radius:12px; font-size:1rem; }
    .inputbar button { background:#004aad; color:#fff; border:none; padding:12px 16px; border-radius:12px; cursor:pointer; }
    .quick { margin: 6px 0 14px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .quick button { background:#e5efff; border:none; padding:6px 10px; border-radius:12px; cursor:pointer; }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="wrap">
      <a class="brand" href="/">Visa Assistant</a>
      <div style="margin-left:auto; display:flex; gap:6px;">
        <a href="/">Predict</a>
        <a href="/wage">Wage Comparator</a>
        <a href="/bulk">Bulk Upload</a>
        <a href="/chat" class="active">Chatbot</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <div class="card pad">
      <h2 style="margin:0 0 6px; color:#004aad;">Visa Assistant</h2>
      <div class="muted" style="margin-bottom: 12px;">Ask about predictions, improvements, wage comparisons, or bulk checks.</div>

      <div class="chat">
        <div class="quick">
          <button onclick="send('Compare my wage')">Compare my wage</button>
          <button onclick="send('How can I improve my chances?')">How can I improve?</button>
          <button onclick="send('Upload CSV for bulk predictions')">Bulk predictions</button>
          <button onclick="send('What affects approval?')">What affects approval?</button>
        </div>

        <div id="msgs" class="msgs">
          <div class="bubble bot">
            Hi! I can explain results, suggest improvements, compare wages, and run bulk predictions.
            What would you like to do?
          </div>
        </div>

        <div class="inputbar">
          <input id="userInput" placeholder="Type your questionâ€¦ e.g., Compare wage for 15-1252 in CA at 100000/year" />
          <button onclick="handleSend()">Send</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    const msgs = document.getElementById('msgs');
    const input = document.getElementById('userInput');

    function append(text, who='me', actions=[]) {
      const div = document.createElement('div');
      div.className = `bubble ${who}`; div.innerText = text; msgs.appendChild(div);
      if (actions && actions.length) {
        const row = document.createElement('div'); row.className = 'actions';
        actions.forEach(a => {
          if (a.href) {
            const link = document.createElement('a'); link.href = a.href; link.target = '_self';
            link.className = 'action-btn'; link.textContent = a.label || 'Open'; row.appendChild(link);
          } else if (a.payload) {
            const btn = document.createElement('button'); btn.className = 'action-btn secondary';
            btn.textContent = a.label || a.payload; btn.onclick = () => send(a.payload); row.appendChild(btn);
          }
        }); msgs.appendChild(row);
      }
      msgs.scrollTop = msgs.scrollHeight;
    }

    async function send(text) {
      if (!text) return;
      append(text, 'me');
      const res = await fetch('/chat/message', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text })
      });
      const data = await res.json();
      append(data.reply || 'Sorry, I did not catch that.', 'bot', data.actions || []);
    }

    function handleSend(){ const text = input.value.trim(); input.value=''; send(text); }
    input.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') handleSend(); });
  </script>
</body>
</html>
